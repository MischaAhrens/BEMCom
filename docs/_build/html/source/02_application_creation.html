<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Creating BEMCom Applications &mdash; BEMCom  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="BEMCom Message Protocol" href="03_message_format.html" />
    <link rel="prev" title="BEMCom Concepts" href="01_concepts.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> BEMCom
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Readme.html">BEMCom Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="01_concepts.html">BEMCom Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="01_concepts.html#application-concept">Application Concept</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Creating BEMCom Applications</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#creating-applications-with-docker">Creating Applications with Docker</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-applications-with-docker-compose">Creating Applications with Docker Compose</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configuring-and-accessing-datapoints">Configuring and Accessing Datapoints</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cleaning-up">Cleaning Up</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="03_message_format.html">BEMCom Message Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="04_contributing.html">Contributing</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">BEMCom</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Creating BEMCom Applications</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/source/02_application_creation.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="creating-bemcom-applications">
<h1>Creating BEMCom Applications<a class="headerlink" href="#creating-bemcom-applications" title="Permalink to this headline"></a></h1>
<p>Recalling the <a class="reference internal" href="01_concepts.html"><span class="doc std std-doc">application concept</span></a>, it is apparent that a functional and building specific HAL instance will require one API service (including the metadata database), one message broker, one or more connector services, and optionally a raw message database service. The BEMCom repository provides fully functional implementations of an API service, a message broker and a raw message database which should be sufficient for most applications, thus effectively removing the burden of implementing these services from the user. All available services, including a number of connector services, can be found in the <span class="xref myst">services</span> folder in this repository.</p>
<p>Leveraging the design concepts of BEMCom, i.e. the service oriented approach and the execution of services as Docker containers, creating an application is reduced to simply configuring and starting the selected services.</p>
<section id="creating-applications-with-docker">
<h2>Creating Applications with Docker<a class="headerlink" href="#creating-applications-with-docker" title="Permalink to this headline"></a></h2>
<p>This is a minimal example showing how a functional BEMCom application can be created by manually starting each service via a shell command, which should work on any machine having Docker installed. Please note that the more convenient way to achieve the same result by utilizing Docker Compose is subject to the <span class="xref myst">following section</span>.</p>
<p>In order to demonstrate the full functionality of BEMCom it is certainly necessary to begin with a device to communicate with. To that end we provide a <span class="xref myst">Demo Device</span> service reflecting a simple Modbus device which can be interpreted as a single room for which the temperature is measured and an actor (say an AC system that can heat and cool) exists to manipulate the room temperature. However, before the first service is started it is necessary to create a Docker network to allow communication between the services.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker network create bemcom-demo
</pre></div>
</div>
<p>After the Docker network exists, it is possible to start the Demo Device with:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker run -d --network bemcom-demo --name bemcom-demo-device bemcom/demo-device-tool:0.1.0
</pre></div>
</div>
<p>Here the <code class="docutils literal notranslate"><span class="pre">-d</span></code> flag will cause Docker to run the Demo Device in the background, <code class="docutils literal notranslate"><span class="pre">--network</span> <span class="pre">bemcom-demo</span></code> will connect the container to the previously created network and  <code class="docutils literal notranslate"><span class="pre">--name</span> <span class="pre">bemcom-demo-device</span></code> will assign the network name <code class="docutils literal notranslate"><span class="pre">bemcom-demo-device</span></code> to the container. To confirm that the Demo Device has been started successfully execute:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker logs bemcom-demo-device
</pre></div>
</div>
<p>Which should create an output similar to this one:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span><span class="o">-</span><span class="n">entrypoint</span><span class="o">.</span><span class="n">sh</span><span class="p">:</span> <span class="n">Starting</span> <span class="n">up</span>
<span class="mi">2022</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">03</span> <span class="mi">09</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mi">04</span><span class="p">,</span><span class="mi">884</span><span class="o">-</span><span class="n">run</span><span class="o">-</span><span class="n">INFO</span><span class="p">:</span> <span class="n">Current</span> <span class="n">temperature</span><span class="p">:</span> <span class="mf">21.0</span>
</pre></div>
</div>
<p>Each BEMCom application requires a central message broker service to allow communication between the remaining services. The broker can be launched using the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker run -d --network bemcom-demo --name bemcom-demo-mqtt-broker bemcom/mosquitto-mqtt-broker:0.1.0
</pre></div>
</div>
<p>Checking the container logs with <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">logs</span> <span class="pre">bemcom-demo-mqtt-broker</span></code> indicates the correct operation by displaying:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">1643880100</span><span class="p">:</span> <span class="n">mosquitto</span> <span class="n">version</span> <span class="mf">1.6.10</span> <span class="n">starting</span>
<span class="mi">1643880100</span><span class="p">:</span> <span class="n">Config</span> <span class="n">loaded</span> <span class="kn">from</span> <span class="o">/</span><span class="n">mosquitto</span><span class="o">/</span><span class="n">config</span><span class="o">/</span><span class="n">mosquitto</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span>
<span class="mi">1643880100</span><span class="p">:</span> <span class="n">Opening</span> <span class="n">ipv4</span> <span class="n">listen</span> <span class="n">socket</span> <span class="n">on</span> <span class="n">port</span> <span class="mf">1883.</span>
<span class="mi">1643880100</span><span class="p">:</span> <span class="n">Opening</span> <span class="n">ipv6</span> <span class="n">listen</span> <span class="n">socket</span> <span class="n">on</span> <span class="n">port</span> <span class="mf">1883.</span>
</pre></div>
</div>
<p>In order to establish communication between the Demo Device and the message broker it is necessary to spin up the corresponding connector, in this particular case that is the <span class="xref myst">Modbus/TCP connector</span> provided in the BEMCom repository, by typing:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker run -d --network bemcom-demo --name bemcom-demo-modbus-tcp-connector -e <span class="nv">MQTT_BROKER_HOST</span><span class="o">=</span>bemcom-demo-mqtt-broker -e <span class="nv">MQTT_BROKER_PORT</span><span class="o">=</span><span class="m">1883</span> -e <span class="nv">CONNECTOR_NAME</span><span class="o">=</span>bemcom-demo-modbus-tcp-connector -e <span class="nv">MODBUS_MASTER_IP</span><span class="o">=</span>bemcom-demo-device -e <span class="nv">MODBUS_MASTER_PORT</span><span class="o">=</span><span class="m">502</span> -e <span class="nv">POLL_SECONDS</span><span class="o">=</span><span class="m">5</span> -e <span class="nv">MODBUS_CONFIG</span><span class="o">=</span><span class="s1">&#39;{&quot;read_input_registers&quot;: [{&quot;address&quot;: 1,&quot;count&quot;:1,&quot;unit&quot;: 1,&quot;datatypes&quot;: &quot;e&quot;}],&quot;write_register&quot;: [{&quot;address&quot;: 1,&quot;unit&quot;: 1,&quot;datatypes&quot;: &quot;&lt;e&quot;,&quot;example_value&quot;: &quot;22.0&quot;}]}&#39;</span> bemcom/modbus-tcp-connector:0.5.0
</pre></div>
</div>
<p>Albeit this shell command may look far more complex then the ones introduced above, it is actually very similar. The only difference is that the connector service is additionally configured via environment variables, that is what follows <code class="docutils literal notranslate"><span class="pre">-e</span></code>, to account for specific settings of the device and the application. In particular, these variables can be interpreted as:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">MQTT_BROKER_HOST=bemcom-demo-mqtt-broker</span></code>: Configures that the connector should connect to the MQTT broker with the network name <code class="docutils literal notranslate"><span class="pre">bemcom-demo-mqtt-broker</span></code>, i.e. the name that has been given in the command above.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MQTT_BROKER_PORT=1883</span></code>: Specifies that the MQTT broker expects a connection on port <code class="docutils literal notranslate"><span class="pre">1883</span></code>, that is the default value for MQTT.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONNECTOR_NAME=bemcom-demo-modbus-tcp-connector</span></code>: Defines the internal name (i.e. the root topic) as  <code class="docutils literal notranslate"><span class="pre">bemcom-demo-modbus-tcp-connector</span></code> for the information exchange on the broker between the connector and other services.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MODBUS_MASTER_IP=bemcom-demo-device</span></code>: Specifies the network name or IP address of the Modbus/TCP device that the connector will attempt to communicate with to <code class="docutils literal notranslate"><span class="pre">bemcom-demo-device</span></code>, i.e. the name that has been given in the command above.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MODBUS_MASTER_PORT=502</span></code>: Defines that the demo device expects connections on port <code class="docutils literal notranslate"><span class="pre">502</span></code>, which is the default value for Modbus/TCP.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">POLL_SECONDS=5</span></code>: Declares that the connector should request the configured sensor values (see below) every five seconds by polling the device.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MODBUS_CONFIG='{&quot;read_input_registers&quot;:</span> <span class="pre">...</span> <span class="pre">}'</span></code>: Configures the Modbus registers which the connector will attempt to read from or write to. In particular, the connector is set up to handle a single sensor datapoint for input register <code class="docutils literal notranslate"><span class="pre">1</span></code> and a single actuator datapoint for holding register <code class="docutils literal notranslate"><span class="pre">1</span></code>. It is worth noting here that the concept of registers is specific to Modbus and that the information which information is exposed on which register is device specific and usually described in the documentation belonging to the device.</p></li>
</ul>
<p>At this point it is important to highlight two important properties about the configuration of BEMCom services via environment variables:</p>
<ol class="arabic simple">
<li><p>It is solely necessary to change the environment variables to adapt a BEMCom service for a particular application or to a specific device. If one would need to connect a second different Modbus device to the demo application above for example, it is intended to use the same image of the Modbus/TCP connector with adjusted environment variables. It is thus possible to very quickly establish connection to even larger numbers of devices if suitable connectors for those exist.</p></li>
<li><p>Which environment variables are available varies per BEMCom service. A documentation about how to configure each service utilizing those variables is provided in the documentation of the services. Regarding the current example, the documentation of the <span class="xref myst">Modbus/TCP connector</span> provides additional details for each environment variable including e.g. extensive discussion how to define the <code class="docutils literal notranslate"><span class="pre">MODBUS_CONFIG</span></code> variable correctly.</p></li>
</ol>
<p>Before moving on it is again a good idea to verify the correct operation of the connector by inspecting the logs with <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">logs</span> <span class="pre">bemcom-demo-modbus-tcp-connector</span></code>, which should yield an output similar to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">2022</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">03</span> <span class="mi">11</span><span class="p">:</span><span class="mi">22</span><span class="p">:</span><span class="mi">19</span><span class="p">,</span><span class="mi">416</span><span class="o">-</span><span class="n">_get_stream</span><span class="o">-</span><span class="n">INFO</span><span class="p">:</span> <span class="n">Python</span><span class="o">-</span><span class="n">dotenv</span> <span class="n">could</span> <span class="ow">not</span> <span class="n">find</span> <span class="n">configuration</span> <span class="n">file</span> <span class="o">.</span><span class="n">env</span><span class="o">.</span>
<span class="mi">2022</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">03</span> <span class="mi">11</span><span class="p">:</span><span class="mi">22</span><span class="p">:</span><span class="mi">19</span><span class="p">,</span><span class="mi">416</span><span class="o">-</span><span class="n">parse_modbus_config</span><span class="o">-</span><span class="n">INFO</span><span class="p">:</span> <span class="n">Parsing</span> <span class="n">MODBUS_CONFIG</span><span class="o">.</span>
<span class="mi">2022</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">03</span> <span class="mi">11</span><span class="p">:</span><span class="mi">22</span><span class="p">:</span><span class="mi">19</span><span class="p">,</span><span class="mi">417</span><span class="o">-</span><span class="n">_get_stream</span><span class="o">-</span><span class="n">INFO</span><span class="p">:</span> <span class="n">Python</span><span class="o">-</span><span class="n">dotenv</span> <span class="n">could</span> <span class="ow">not</span> <span class="n">find</span> <span class="n">configuration</span> <span class="n">file</span> <span class="o">.</span><span class="n">env</span><span class="o">.</span>
<span class="mi">2022</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">03</span> <span class="mi">11</span><span class="p">:</span><span class="mi">22</span><span class="p">:</span><span class="mi">19</span><span class="p">,</span><span class="mi">417</span><span class="o">-</span><span class="fm">__init__</span><span class="o">-</span><span class="n">INFO</span><span class="p">:</span> <span class="n">Initiating</span> <span class="n">pyconnector</span><span class="o">.</span><span class="n">Connector</span> <span class="k">class</span> <span class="nc">for</span><span class="p">:</span> <span class="n">bemcom</span><span class="o">-</span><span class="n">demo</span><span class="o">-</span><span class="n">modbus</span><span class="o">-</span><span class="n">tcp</span><span class="o">-</span><span class="n">connector</span>
<span class="mi">2022</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">03</span> <span class="mi">11</span><span class="p">:</span><span class="mi">22</span><span class="p">:</span><span class="mi">19</span><span class="p">,</span><span class="mi">417</span><span class="o">-</span><span class="fm">__init__</span><span class="o">-</span><span class="n">INFO</span><span class="p">:</span> <span class="n">Changing</span> <span class="n">log</span> <span class="n">level</span> <span class="n">to</span> <span class="n">INFO</span>
<span class="mi">2022</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">03</span> <span class="mi">11</span><span class="p">:</span><span class="mi">22</span><span class="p">:</span><span class="mi">19</span><span class="p">,</span><span class="mi">421</span><span class="o">-</span><span class="n">run</span><span class="o">-</span><span class="n">INFO</span><span class="p">:</span> <span class="n">Connector</span> <span class="n">online</span><span class="o">.</span> <span class="n">Entering</span> <span class="n">main</span> <span class="n">loop</span><span class="o">.</span>
</pre></div>
</div>
<p>At this point only an API service is missing to form a fully functional BEMCom application. The following command allows to create a container with such a service:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker run -d --network bemcom-demo -p <span class="m">8080</span>:8080 --name bemcom-demo-django-api -e <span class="nv">MQTT_BROKER_HOST</span><span class="o">=</span>bemcom-demo-mqtt-broker -e <span class="nv">MQTT_BROKER_PORT</span><span class="o">=</span><span class="m">1883</span> -e <span class="nv">DJANGO_SUPERUSER_USERNAME</span><span class="o">=</span>bemcom -e <span class="nv">DJANGO_SUPERUSER_PASSWORD</span><span class="o">=</span>bemcom -e <span class="nv">DJANGO_SUPERUSER_EMAIL</span><span class="o">=</span>bemcom@example.com -e <span class="nv">DJANGO_ALLOWED_HOSTS</span><span class="o">=</span><span class="s1">&#39;[&quot;*&quot;]&#39;</span> bemcom/django-api:0.6.10
</pre></div>
</div>
<p>Similar to the connector service above, the API service is configured via environment variables to connect the the message broker. Additionally three environment variables starting with <code class="docutils literal notranslate"><span class="pre">DJANGO_SUPERUSER_</span></code> are exposed to the service which define the login credentials and email address of an administrator user. The latter allows to configure which datapoints of the devices will be used by the BEMCom application, to edit the metadata of these datapoints but also allows administration of access control mechanisms to prevent the REST interface of the API service from unauthorized usage. The values of these three variables are obviously not suitable for any productive use and should be changed for any non demo application. This also holds for <code class="docutils literal notranslate"><span class="pre">DJANGO_ALLOWED_HOSTS</span></code> variable, which is security relevant, but not important to understand for the sake of demonstrating a simple BEMCom application. Additional details on this and all available environment variables are provided in the <span class="xref myst">documentation page of the API service</span>.</p>
<p>In order to verify that the API service operates as intended, one can inspect the logs once more with <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">logs</span> <span class="pre">bemcom-demo-django-api</span></code> which will generate a longer output. The important line to check for should look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">2022</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">07</span> <span class="mi">08</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="mi">47</span><span class="p">,</span><span class="mi">751</span><span class="o">-</span><span class="n">daphne</span><span class="o">.</span><span class="n">server</span><span class="o">-</span><span class="n">INFO</span><span class="p">:</span> <span class="n">Listening</span> <span class="n">on</span> <span class="n">TCP</span> <span class="n">address</span> <span class="mf">0.0.0.0</span><span class="p">:</span><span class="mi">8080</span>
</pre></div>
</div>
<p>This indicates that the API service operates and the REST interface as well as the graphical administration user interface are exposed on container port <code class="docutils literal notranslate"><span class="pre">8080</span></code>, which should also be available on the same port of the host machine.</p>
<p><strong>Congratulations! You now operate a functional BEMCom application!</strong> Before it is possible to access the datapoint data via the REST interface it is necessary to configure the datapoint metadata in the administration user interface provided by the API service. This is described <span class="xref myst">below</span>.</p>
</section>
<section id="creating-applications-with-docker-compose">
<h2>Creating Applications with Docker Compose<a class="headerlink" href="#creating-applications-with-docker-compose" title="Permalink to this headline"></a></h2>
<p>As we have seen in the section above, starting each service manually is a tedious process. In practice it is usually better to write the desired application into a configuration file and execute this. One particularly simple way to implement such an approach is to utilize <a class="reference external" href="https://docs.docker.com/compose/gettingstarted/">Docker Compose</a> . The following <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> file will lead to the same result as the individual steps above, where more detailed explanation is provided.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3&#39;</span><span class="w"></span>

<span class="nt">services</span><span class="p">:</span><span class="w"></span>

<span class="w">    </span><span class="nt">bemcom-demo-device</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bemcom-demo-device</span><span class="w"></span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bemcom/demo-device-tool:0.1.0</span><span class="w"></span>

<span class="w">    </span><span class="nt">bemcom-demo-modbus-tcp-connector</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bemcom-demo-modbus-tcp-connector</span><span class="w"></span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bemcom/modbus-tcp-connector:0.5.0</span><span class="w"></span>
<span class="w">        </span><span class="nt">depends_on</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bemcom-demo-device</span><span class="w"></span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bemcom-demo-mqtt-broker</span><span class="w"></span>
<span class="w">        </span><span class="nt">environment</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CONNECTOR_NAME=bemcom-demo-modbus-tcp-connector</span><span class="w"></span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MQTT_BROKER_HOST=bemcom-demo-mqtt-broker</span><span class="w"></span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MQTT_BROKER_PORT=1883</span><span class="w"></span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">POLL_SECONDS=5</span><span class="w"></span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MODBUS_MASTER_IP=bemcom-demo-device</span><span class="w"></span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MODBUS_MASTER_PORT=502</span><span class="w"></span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;MODBUS_CONFIG={&quot;read_input_registers&quot;:</span><span class="nv"> </span><span class="s">[{&quot;address&quot;:</span><span class="nv"> </span><span class="s">1,&quot;count&quot;:1,&quot;unit&quot;:</span><span class="nv"> </span><span class="s">1,&quot;datatypes&quot;:</span><span class="nv"> </span><span class="s">&quot;e&quot;}],&quot;write_register&quot;:</span><span class="nv"> </span><span class="s">[{&quot;address&quot;:</span><span class="nv"> </span><span class="s">1,&quot;unit&quot;:</span><span class="nv"> </span><span class="s">1,&quot;datatypes&quot;:</span><span class="nv"> </span><span class="s">&quot;&lt;e&quot;,&quot;example_value&quot;:</span><span class="nv"> </span><span class="s">&quot;22.0&quot;}]}&#39;</span><span class="w"></span>

<span class="w">    </span><span class="nt">bemcom-demo-mqtt-broker</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bemcom-demo-mqtt-broker</span><span class="w"></span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bemcom/mosquitto-mqtt-broker:0.1.0</span><span class="w"></span>

<span class="w">    </span><span class="nt">bemcom-demo-django-api</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bemcom-demo-django-api</span><span class="w"></span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bemcom/django-api:0.6.10</span><span class="w"></span>
<span class="w">        </span><span class="nt">depends_on</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bemcom-demo-mqtt-broker</span><span class="w"></span>
<span class="w">        </span><span class="nt">ports</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080:8080</span><span class="w"></span>
<span class="w">        </span><span class="nt">environment</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MQTT_BROKER_HOST=bemcom-demo-mqtt-broker</span><span class="w"></span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MQTT_BROKER_PORT=1883</span><span class="w"></span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;DJANGO_ALLOWED_HOSTS=[&quot;*&quot;]&#39;</span><span class="w"></span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DJANGO_SUPERUSER_USERNAME=bemcom</span><span class="w"></span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DJANGO_SUPERUSER_PASSWORD=bemcom</span><span class="w"></span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DJANGO_SUPERUSER_EMAIL=bemcom@example.com</span><span class="w"></span>
</pre></div>
</div>
<p>Using this file the BEMCom application can be started using a simple <code class="docutils literal notranslate"><span class="pre">docker-compose</span> <span class="pre">up</span></code> command. Please refer to the <a class="reference external" href="https://docs.docker.com/compose/">official documentation</a> for more details about Docker Compose and how to use it.</p>
</section>
<section id="configuring-and-accessing-datapoints">
<h2>Configuring and Accessing Datapoints<a class="headerlink" href="#configuring-and-accessing-datapoints" title="Permalink to this headline"></a></h2>
<p>Once the BEMCom demo application has been started with either one of the two approaches introduced in the previous sections, it remains to configure the datapoints. This can be done utilizing the graphical administration user interface provided by the API service. Assuming that the containers are executed on the local machine, one can access the UI on the following URL:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8080</span><span class="o">/</span><span class="n">admin</span><span class="o">/</span>
</pre></div>
</div>
<p>Visited for the first time the login prompt should be shown.</p>
<p><img alt="application_creation_01_login" src="../_images/application_creation_01_login.png" /></p>
<p>After logging in with the credentials configured above (user: <code class="docutils literal notranslate"><span class="pre">bemcom</span></code> password: <code class="docutils literal notranslate"><span class="pre">bemcom</span></code> by default), the main page of the administration panel is shown.</p>
<p style="color:red;"><b>TODO: Add pictures and explanations once the last value endpoint and HISTORY_DB flags have been implemented.</b></p>
</section>
<section id="cleaning-up">
<h2>Cleaning Up<a class="headerlink" href="#cleaning-up" title="Permalink to this headline"></a></h2>
<p>If the containers were created manually (i.e. by executing one <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span></code> command per service) the following commands stop and remove the containers and the network.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker container stop bemcom-demo-device bemcom-demo-modbus-tcp-connector bemcom-demo-mqtt-broker bemcom-demo-django-api
docker container rm bemcom-demo-device bemcom-demo-modbus-tcp-connector bemcom-demo-mqtt-broker bemcom-demo-django-api
docker network rm bemcom-demo
</pre></div>
</div>
<p>If the demo application has been started with Docker Compose the following command should be sufficient to achieve the same result:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker-compose down
</pre></div>
</div>
<p>Finally, one may wish to remove the docker images that have been loaded to run the demo application (to free the hard drive) with the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">image</span> <span class="n">rm</span> <span class="n">bemcom</span><span class="o">/</span><span class="n">demo</span><span class="o">-</span><span class="n">device</span><span class="o">-</span><span class="n">tool</span><span class="p">:</span><span class="mf">0.1.0</span> <span class="n">bemcom</span><span class="o">/</span><span class="n">modbus</span><span class="o">-</span><span class="n">tcp</span><span class="o">-</span><span class="n">connector</span><span class="p">:</span><span class="mf">0.5.0</span> <span class="n">bemcom</span><span class="o">/</span><span class="n">mosquitto</span><span class="o">-</span><span class="n">mqtt</span><span class="o">-</span><span class="n">broker</span><span class="p">:</span><span class="mf">0.1.0</span> <span class="n">bemcom</span><span class="o">/</span><span class="n">django</span><span class="o">-</span><span class="n">api</span><span class="p">:</span><span class="mf">0.6.10</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="01_concepts.html" class="btn btn-neutral float-left" title="BEMCom Concepts" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="03_message_format.html" class="btn btn-neutral float-right" title="BEMCom Message Protocol" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, FZI Research Center for Information Technology.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>